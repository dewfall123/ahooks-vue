var e=Object.assign;import{g as t,i as n,e as r,f as o,l as a,h as l}from"./app.3288cba1.js";import{u as s}from"./index.83860725.js";const i={formatResult:e=>e,requestMethod:function(e){let t,n;return"string"==typeof e?t=e:(t=e.url,n=e),fetch(t,n).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))},manual:!1,onSuccess:()=>{},onError:()=>{},onFinally:()=>{},defaultLoading:!1,loadingDelay:0,pollingInterval:0,pollingWhenHidden:!0,pollingSinceLastFinished:!0,defaultParams:[],debounceInterval:0,loadingWhenDebounceStart:!0,throttleInterval:0,initialData:void 0,throwOnError:!1,refreshDeps:[],refreshOnWindowFocus:!1},u=Symbol("useRequestConfig");function c(c,f={}){var v;let d={};t()&&(d=null!=(v=n(u))?v:{});const h=e(e(e({},i),d),f),{requestMethod:m,defaultLoading:g,manual:p,throwOnError:b,onSuccess:I,onError:w,onFinally:D,formatResult:y,initialData:S,defaultParams:T,loadingDelay:j,debounceInterval:P,loadingWhenDebounceStart:E,throttleInterval:F,pollingInterval:O,pollingWhenHidden:W,pollingSinceLastFinished:L,refreshOnWindowFocus:R,refreshDeps:q}=h;let x;x=["string","object"].includes(typeof c)?()=>m(c):(...e)=>new Promise(((t,n)=>{const r=c(...e);let o=r;if(!r.then){if(!["string","object"].includes(typeof r))throw new Error("If sevice is a function, it must return a String, Object or Promise");o=m(r)}o.then(t).catch(n)}));const H=r(g),M=r(S),V=r(),k=r(T),C=r(T);let z=0,A=!1;t()&&o((()=>{A=!0}));let B,G,J=r(!0);function K(...e){G&&clearTimeout(G),B&&clearTimeout(B),j?B=setTimeout((()=>{H.value=!0}),j):H.value=!0,z++;const t=z;k.value=a.cloneDeep(e);const n=()=>A||t!==z;return x(...e).then((t=>{if(n())return;const r=y(t);return M.value=r,C.value=a.cloneDeep(e),I(r,e),r})).catch((t=>{if(!n()&&(console.error(t),V.value=t,w(t,e),b))throw t})).finally((()=>{n()||(B&&clearTimeout(B),O&&L&&(G=W&&!J.value?setInterval((()=>{W&&!J.value||(clearInterval(G),K(...e))}),O):setTimeout((()=>{K(...e)}),O)),H.value=!1,D())}))}t()&&(J=s({onVisible(){R&&U()}}).isVisible);let N,Q=K;if(P){const e=a.debounce(K,P);Q=(...t)=>(E&&(H.value=!0),Promise.resolve(e(...t)))}if(F){const e=a.throttle(K,F);Q=(...t)=>Promise.resolve(e(...t))}function U(){return Q(...k.value)}return O&&!L&&(Q=(...e)=>(N&&clearInterval(N),N=setInterval((()=>{W&&!J.value||K(...e)}),O),K(...e))),p||Q(...T),l(q,U),{loading:H,error:V,data:M,run:Q,params:k,lastSuccessParams:C,cancel:()=>{N&&clearInterval(N),G&&clearTimeout(G),B&&clearTimeout(B),z++,H.value=!1},refresh:U}}export{u as R,c as u};
